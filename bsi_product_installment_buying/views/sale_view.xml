<?xml version="1.0" encoding="utf-8"?>
<odoo>

   <record id="sale_order_view_list" model="ir.ui.view">
      <field name="name">sale.order.list.view.inherit</field>
      <field name="model">sale.order</field>
      <field name="inherit_id" ref="sale.view_order_form" />
      <field name="priority">10</field>
      <field name="arch" type="xml">
         <!--
               Here, in sale.orde.line inherited list view, we have added the relevant fields related to
         installment that specifies the installment details.
            -->
         <xpath
            expr="/form/sheet/notebook/page/field[@name='order_line']/list/field[@name='tax_id']"
            position="after">
            <field name="installment_ok" invisible="1" />
         </xpath>
         <xpath
            expr="/form/sheet/notebook/page/field[@name='order_line']/list/field[@name='installment_ok']"
            position="after">
            <field name="is_installment_invoice"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not installment_ok" />
         </xpath>
         <xpath
            expr="/form/sheet/notebook/page/field[@name='order_line']/list/field[@name='is_installment_invoice']"
            position="after">
            <field name="installment_id"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" required="is_installment_invoice" />
         </xpath>
         <xpath
            expr="/form/sheet/notebook/page/field[@name='order_line']/list/field[@name='installment_id']"
            position="after">
            <field name="installment_amt"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" />
         </xpath>
         <xpath expr="/form/sheet/notebook" position="inside">
            <page string="Installment Details"
               groups="bsi_product_installment_buying.bsi_allowed_installment">
               <group>
                  <group>
                     <field name="overall_installments" />
                     <field name="current_installment" />
                  </group>
                  <group>
                     <field name="total_installment_amount" />
                     <field name="total_installment_due" />
                  </group>
               </group>
               <field name="bsi_account_move">
                  <list editable="bottom" default_order="installment_number asc"
                     decoration-success="payment_state == 'paid'"
                     decoration-danger="payment_state == 'not_paid' and 'currennt date > invoice date'">
                     <field name="installment_number" />
                     <field name="name" />
                     <field name='invoice_date' />
                     <field name='invoice_date_due' />
                     <field name='amount_untaxed_signed' />
                     <field name="amount_total_signed" />
                     <field name="amount_residual_signed" />
                     <field name="payment_state" widget="badge"
                        decoration-danger="payment_state == 'not_paid'"
                        decoration-warning="payment_state in ('partial', 'in_payment')"
                        decoration-success="payment_state in ('paid', 'reversed')" />
                     <field name="state" widget="badge" decoration-success="state == 'posted'"
                        decoration-info="state == 'draft'" />
                  </list>
               </field>
            </page>
         </xpath>
      </field>
   </record>

   <record id="account_move_view_list" model="ir.ui.view">
      <field name="name">account.move.list.view.inherit</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="priority">10</field>
      <field name="arch" type="xml">
         <!--
               Here, in the account.move inherited list view, we have added 'installment_id' field that will
         display the appropriate installment in the generated invoice.
            -->
         <xpath
            expr="/form/sheet/notebook/page/field[@name='invoice_line_ids']/list/field[@name='tax_ids']"
            position="after">
            <field name="installment_id"
               groups="bsi_product_installment_buying.bsi_allowed_installment" invisible='1' />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='invoice_date']" position="after">
            <field name="is_installment_invoice" invisible='1' />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='is_installment_invoice']"
            position="after">
            <field name="total_installments"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='total_installments']"
            position="after">
            <field name="installment_number"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" />
         </xpath>
      </field>
   </record>

   <record id="account_move_view_list" model="ir.ui.view">
      <field name="name">account.move.list.view.inherit</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="priority">10</field>
      <field name="arch" type="xml">
         <!--
               Here, in the account.move inherited list view, we have added 'installment_id' field that will
         display the appropriate installment in the generated invoice.
            -->
         <xpath
            expr="/form/sheet/notebook/page/field[@name='invoice_line_ids']/list/field[@name='tax_ids']"
            position="after">
            <field name="installment_id"
               groups="bsi_product_installment_buying.bsi_allowed_installment" invisible='1' />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='invoice_date']" position="after">
            <field name="is_installment_invoice" invisible='1' />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='is_installment_invoice']"
            position="after">
            <field name="total_installments"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" />
         </xpath>
         <xpath expr="//form/sheet//group//group//field[@name='total_installments']"
            position="after">
            <field name="installment_number"
               groups="bsi_product_installment_buying.bsi_allowed_installment"
               invisible="not is_installment_invoice" />
         </xpath>
      </field>
   </record>
</odoo>